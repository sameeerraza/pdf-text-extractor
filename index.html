<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Text Extractor - Free OCR Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <style>
        /* --- your existing styles stay unchanged --- */
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); color: white; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        /* ... (keeping all previous CSS from your code) ... */
        .settings {
            margin: 20px 0;
            text-align: center;
        }
        .settings select {
            padding: 8px 12px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>📄 PDF Text Extractor</h1>
        <p>Extract text from scanned PDFs using advanced OCR technology</p>
    </div>

    <div class="main-card">
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">📁</div>
            <div class="upload-text">Drop your scanned PDF here</div>
            <div class="upload-subtext">or click to browse files • Max 10MB</div>
        </div>

        <input type="file" id="fileInput" accept=".pdf">

        <div class="file-info" id="fileInfo">
            <div class="file-details">
                <div>
                    <strong id="fileName">document.pdf</strong>
                    <div id="fileSize">2.5 MB</div>
                </div>
                <div id="fileIcon">📄</div>
            </div>
        </div>

        <!-- New settings -->
        <div class="settings">
            <label for="resolution">🖼️ OCR Resolution:</label>
            <select id="resolution">
                <option value="1.5">Low</option>
                <option value="2.0" selected>Medium</option>
                <option value="2.5">High</option>
            </select>
        </div>

        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Processing...</div>
        </div>

        <div class="status" id="status"></div>

        <div class="buttons">
            <button id="extractBtn" class="primary" disabled>🔍 Extract Text</button>
            <button id="downloadBtn" style="display: none;">💾 Download Text File</button>
            <button id="resetBtn" style="display: none;">🔄 Start Over</button>
        </div>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    let selectedFile = null;
    let extractedText = '';

    // DOM elements
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const extractBtn = document.getElementById('extractBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const progressSection = document.getElementById('progressSection');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const status = document.getElementById('status');
    const resolutionSelect = document.getElementById('resolution');

    // Event listeners
    uploadZone.addEventListener('click', () => fileInput.click());
    uploadZone.addEventListener('dragover', e => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });
    uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
    uploadZone.addEventListener('drop', e => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', e => {
        if (e.target.files.length > 0) handleFile(e.target.files[0]);
    });
    extractBtn.addEventListener('click', extractText);
    downloadBtn.addEventListener('click', downloadText);
    resetBtn.addEventListener('click', resetApp);

    function handleFile(file) {
        if (file.type !== 'application/pdf') {
            showStatus('❌ Please select a PDF file.', 'error');
            return;
        }
        if (file.size > 10 * 1024 * 1024) {
            showStatus('❌ File size must be less than 10MB.', 'error');
            return;
        }
        selectedFile = file;
        fileName.textContent = file.name;
        fileSize.textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
        fileInfo.style.display = 'block';
        extractBtn.disabled = false;
        showStatus('✅ File uploaded successfully! Click "Extract Text" to begin.', 'success');
    }

    async function extractText() {
        if (!selectedFile) return;

        extractBtn.disabled = true;
        downloadBtn.style.display = 'none';
        resetBtn.style.display = 'none';
        progressSection.style.display = 'block';
        extractedText = '';

        try {
            showProgress(5, '📖 Loading PDF...');
            const arrayBuffer = await selectedFile.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

            const totalPages = pdf.numPages;
            let allText = `📄 EXTRACTED TEXT FROM: ${selectedFile.name}\n`;
            allText += `📅 Processed on: ${new Date().toLocaleString()}\n`;
            allText += `📑 Total Pages: ${totalPages}\n`;
            allText += `${'='.repeat(60)}\n\n`;

            // Create Tesseract worker
            const worker = await Tesseract.createWorker('eng');

            const scale = parseFloat(resolutionSelect.value);

            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                const progress = 15 + (pageNum / totalPages) * 70;
                showProgress(progress, `🔍 Processing page ${pageNum} of ${totalPages}...`);

                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport }).promise;
                const imageData = canvas.toDataURL('image/png');

                // OCR with worker
                const { data } = await worker.recognize(imageData);
                allText += `📄 PAGE ${pageNum}\n`;
                allText += `-`.repeat(40) + '\n';
                allText += data.text.trim() + '\n\n';
            }

            await worker.terminate();

            extractedText = allText;
            showProgress(100, '🎉 Extraction complete!');

            setTimeout(() => {
                progressSection.style.display = 'none';
                downloadBtn.style.display = 'inline-block';
                resetBtn.style.display = 'inline-block';
                showStatus(`🎉 Extracted text from ${totalPages} page(s).`, 'success');
            }, 1000);
        } catch (err) {
            console.error(err);
            showStatus('❌ Error: ' + err.message, 'error');
            progressSection.style.display = 'none';
        } finally {
            extractBtn.disabled = false;
        }
    }

    function downloadText() {
        if (!extractedText) return;
        const blob = new Blob([extractedText], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = selectedFile.name.replace('.pdf', '_extracted_text.txt');
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showStatus('💾 File downloaded successfully!', 'success');
    }

    function resetApp() {
        selectedFile = null;
        extractedText = '';
        fileInput.value = '';
        fileInfo.style.display = 'none';
        extractBtn.disabled = true;
        downloadBtn.style.display = 'none';
        resetBtn.style.display = 'none';
        progressSection.style.display = 'none';
        status.style.display = 'none';
    }

    function showProgress(percent, text) {
        progressFill.style.width = `${Math.min(percent, 100)}%`;
        progressText.textContent = text;
    }

    function showStatus(message, type) {
        status.textContent = message;
        status.className = `status ${type}`;
        status.style.display = 'block';
        if (type === 'success' || type === 'info') {
            setTimeout(() => { status.style.display = 'none'; }, 6000);
        }
    }
</script>
</body>
</html>
